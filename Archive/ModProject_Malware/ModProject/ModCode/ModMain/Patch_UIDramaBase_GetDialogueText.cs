using HarmonyLib;

namespace MOD_OBF7hC
{
    [HarmonyPatch(typeof(UIDramaBase))]
    internal class Patch_UIDramaBase_GetDialogueText
    {
        [HarmonyPostfix]
        [HarmonyPatch("GetDialogueText")]
        private static void GetDialogueText(DramaData dramaData, ref string __result)
        {
            if (__result.Contains("["))
            {
                __result = __result.Replace("[P0]", "<color=#FF0000>" + g.world.playerUnit.data.unitData.propertyData.GetName() + "</color>");
                __result = __result.Replace("[P1]", "<color=#FF0000>" + g.world.playerUnit.data.unitData.propertyData.name[0] + "</color>");
                __result = __result.Replace("[P2]", "<color=#FF0000>" + g.world.playerUnit.data.unitData.propertyData.name[1] + "</color>");
                if (dramaData.unitLeft != null)
                {
                    string newValue = "<color=#00FF00>" + dramaData.unitLeft.data.unitData.propertyData.GetName() + "</color>";
                    string newValue2 = "<color=#00FF00>" + dramaData.unitLeft.data.unitData.propertyData.name[0] + "</color>";
                    _ = "<color=#00FF00>" + dramaData.unitLeft.data.unitData.propertyData.name[1] + "</color>";
                    string newValue3 = ((dramaData.unitLeft.data.unitData.propertyData.name[1].Length == 1) ? ("<color=#00FF00>" + dramaData.unitLeft.data.unitData.propertyData.name[1] + "儿</color>") : ("<color=#00FF00>" + dramaData.unitLeft.data.unitData.propertyData.name[1] + "</color>"));
                    __result = __result.Replace("[A0]", newValue);
                    __result = __result.Replace("[A1]", newValue2);
                    __result = __result.Replace("[A2]", newValue3);
                }
                if (dramaData.unitRight != null)
                {
                    string newValue4 = "<color=#0000FF>" + dramaData.unitRight.data.unitData.propertyData.GetName() + "</color>";
                    string newValue5 = "<color=#0000FF>" + dramaData.unitRight.data.unitData.propertyData.name[0] + "</color>";
                    string newValue6 = "<color=#0000FF>" + dramaData.unitRight.data.unitData.propertyData.name[1] + "</color>";
                    __result = __result.Replace("[B0]", newValue4);
                    __result = __result.Replace("[B1]", newValue5);
                    __result = __result.Replace("[B2]", newValue6);
                }
            }
        }
    }
}
