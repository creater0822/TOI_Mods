using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.IO;
using HarmonyLib;
using UnityEngine;
using UnityEngine.UI;

namespace MOD_OBF7hC
{
    [HarmonyPatch(typeof(DramaFunction))]
    public class Patch_DramaFunction_OptionsFunction
    {
        public static UIBase YemianKL41UI;
        public static UIBase YemianKL51UI;
        private static GameObject goBoxiang3;

        [HarmonyPrefix]
        [HarmonyPatch("OptionsFunction")]
        public static bool OptionsFunction(DramaFunction __instance, ref string function, DramaFunctionData functionData)
        {
            if (string.IsNullOrEmpty(function) || function == "0")
            {
                return false;
            }
            __instance._data = functionData;
            if (__instance.data == null)
            {
                __instance._data = new DramaFunctionData();
            }
            string[] array = function.Split('|');
            List<string> list = new List<string>();
            string[] array2 = array;
            foreach (string text in array2)
            {
                string[] array3 = text.Split('_');
                if (array3[0].Equals("KL"))
                {
                    OptionMyFuction(__instance, text, array3);
                }
                else
                {
                    list.Add(text);
                }
            }
            if (list.Count > 0)
            {
                function = string.Join("|", list);
                return true;
            }
            return false;
        }

        private static void OptionMyFuction(DramaFunction __instance, string func, string[] parameters)
        {
            switch (parameters[1])
            {
                case "SXDF002":
                    OpenUICheckPopup(__instance, func, parameters);
                    break;
                case "SXDF003":
                    OpenUICheckPopup1(__instance, func, parameters);
                    break;
                case "SXDF004":
                    OpenUICheckPopup2(__instance, func, parameters);
                    break;
            }
        }

        private static void OpenUICheckPopup(DramaFunction __instance, string func, string[] parameters)
        {
            Application.OpenURL("https://afdian.net/a/kaolas");
            Console.WriteLine("executed the logic");
        }

        private static void OpenUICheckPopup1(DramaFunction __instance, string func, string[] parameters)
        {
            Console.WriteLine("executed the logic 2");
            YemianKL51UI = g.ui.OpenUI(new UIType.UITypeBase("YemianKL51", UILayer.UI));
            YemianKL51UI.transform.Find("KLButton109");
            if (!(YemianKL51UI != null))
            {
                return;
            }
            Transform transform = YemianKL51UI.transform.Find("KLButton109");
            Transform transform2 = YemianKL51UI.transform.Find("Root/KLImage/KLButton402");
            Button component = transform.GetComponent<Button>();
            Button component2 = transform2.GetComponent<Button>();
            Action action = delegate
            {
                g.ui.CloseUI(YemianKL51UI);
            };
            component.onClick.AddListener(action);
            Transform transform3 = GameObject.Find("Game/UIRoot/Canvas/Root/UI/YemianKL51/Root/KLImage").transform;
            int depth = 9999;
            goBoxiang3 = GameEffectTool.CreateGo("Effect/UI/genpilong_huaxing_nv", transform3, depth, 0f);
            goBoxiang3.transform.localScale = new Vector3(1.5f, 1.5f, 1f);
            goBoxiang3.transform.localPosition = new Vector3(355.8183f, 177.4568f, 0f);
            if (component2 != null)
            {
                Button component3 = component2.GetComponent<Button>();
                Action action2 = delegate
                {
                    Application.OpenURL("https://afdian.net/a/kaolas");
                };
                component3.onClick.AddListener(action2);
            }
        }

        private static void OpenUICheckPopup2(DramaFunction __instance, string func, string[] parameters)
        {
            Console.WriteLine("executed the logic 3");
            YemianKL41UI = g.ui.OpenUI(new UIType.UITypeBase("YemianKL41", UILayer.UI));
            if (!(YemianKL41UI != null))
            {
                return;
            }
            Transform transform = YemianKL41UI.transform.Find("Root/KLImg/KLimg1/Diyibu1/KLButton");
            Transform transform2 = YemianKL41UI.transform.Find("Root/KLImg/KLimg1/Diyibu1/KLButton1");
            Transform transform3 = YemianKL41UI.transform.Find("Root/KLImg/KLimg1/Diyibu1/KLButton2");
            Transform transform4 = YemianKL41UI.transform.Find("Root/KLImg/KLimg1/Diyibu2/KLButton");
            Transform transform5 = YemianKL41UI.transform.Find("Root/KLImg/KLimg1/Diyibu3/KLButton01");
            Transform transform6 = YemianKL41UI.transform.Find("Root/KLImg/KLimg1/Diyibu3/KLButton02");
            Transform transform7 = YemianKL41UI.transform.Find("Root/KLImg/KLimg1/Diyibu4/KLButton01");
            Transform transform8 = YemianKL41UI.transform.Find("Root/KLImg/KLimg1/Diyibu4/KLButton02");
            Transform transform9 = YemianKL41UI.transform.Find("Root/KLImg/KLimg1/Diyibu4/KLButton03");
            Transform transform10 = YemianKL41UI.transform.Find("Root/KLImg/ButtonClors");
            if (transform != null)
            {
                Button component = transform.GetComponent<Button>();
                Action action = delegate
                {
                    Application.OpenURL("https://pan.baidu.com/s/1rZjL8S4G7a722RfZqgttxQ?pwd=8888");
                };
                component.onClick.AddListener(action);
            }
            if (transform2 != null)
            {
                Button component2 = transform2.GetComponent<Button>();
                Action action2 = delegate
                {
                    Application.OpenURL("https://pan.baidu.com/s/1q1YARn_EAWXYztPAWJMKwA?pwd=8888");
                };
                component2.onClick.AddListener(action2);
            }
            if (transform3 != null)
            {
                Button component3 = transform3.GetComponent<Button>();
                Action action3 = delegate
                {
                    string dataPath3 = Application.dataPath;
                    string path3 = "ModExportData";
                    string text3 = Path.Combine(Path.GetDirectoryName(dataPath3), path3);
                    if (Directory.Exists(text3))
                    {
                        Console.WriteLine("Koala ModExportData Directory：" + text3);
                        Process.Start(text3);
                    }
                    else
                    {
                        Console.WriteLine("Koala ModExportData directory not found!");
                    }
                };
                component3.onClick.AddListener(action3);
            }
            if (transform4 != null)
            {
                Button component4 = transform4.GetComponent<Button>();
                Action action4 = delegate
                {
                    string dataPath2 = Application.dataPath;
                    string path2 = "ModExportData/Mod_OBF7hC";
                    string text2 = Path.Combine(Path.GetDirectoryName(dataPath2), path2);
                    if (Directory.Exists(text2))
                    {
                        Console.WriteLine("Koala ModExportData/Mod_OBF7hC directory：" + text2);
                        Process.Start(text2);
                    }
                    else
                    {
                        Console.WriteLine("Koala ModExportData/Mod_OBF7hC directory not found!");
                    }
                };
                component4.onClick.AddListener(action4);
            }
            if (transform5 != null)
            {
                Button component5 = transform5.GetComponent<Button>();
                Action action5 = delegate
                {
                    Application.OpenURL("https://www.paddi.vip/guigu/kl");
                };
                component5.onClick.AddListener(action5);
            }
            if (transform6 != null)
            {
                Button component6 = transform6.GetComponent<Button>();
                Action action6 = delegate
                {
                    string dataPath = Application.dataPath;
                    string path = "ModExportData/Mod_OBF7hC/ModAssets";
                    string text = Path.Combine(Path.GetDirectoryName(dataPath), path);
                    if (Directory.Exists(text))
                    {
                        Console.WriteLine("The Koala secret key is stored in the ModExportData/Mod_OBF7hC/ModAssets directory：" + text);
                        Process.Start(text);
                    }
                    else
                    {
                        Console.WriteLine("The Koala key storage ModExportData/Mod_OBF7hC/ModAssets directory was not found!");
                    }
                };
                component6.onClick.AddListener(action6);
            }
            if (transform7 != null)
            {
                Button component7 = transform7.GetComponent<Button>();
                Action action7 = delegate
                {
                    Application.OpenURL("https://qm.qq.com/q/tfM5BwpRkY");
                };
                component7.onClick.AddListener(action7);
            }
            if (transform8 != null)
            {
                Button component8 = transform8.GetComponent<Button>();
                Action action8 = delegate
                {
                    Application.OpenURL("https://qm.qq.com/q/xzGjcGTxT4");
                };
                component8.onClick.AddListener(action8);
            }
            if (transform9 != null)
            {
                Button component9 = transform9.GetComponent<Button>();
                Action action9 = delegate
                {
                    Application.OpenURL("https://qm.qq.com/q/9ThuUzb1mM");
                };
                component9.onClick.AddListener(action9);
            }
            if (transform10 != null)
            {
                Button component10 = transform10.GetComponent<Button>();
                Action action10 = delegate
                {
                    g.ui.CloseUI(YemianKL41UI);
                };
                component10.onClick.AddListener(action10);
            }
        }
    }
}
